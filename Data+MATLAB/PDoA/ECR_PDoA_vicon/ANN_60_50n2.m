function [Y,Xf,Af] = ANN_60_50n2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 02-May-2020 23:30:28.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx4 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx3 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-166881;627;-105928;629];
x1_step1.gain = [6.4553820133691e-06;0.000655522779416585;8.43401437999452e-06;0.000655737704918033];
x1_step1.ymin = -1;

% Layer 1
b1 = [-2.9891932878868452406;2.9145783305674570762;11.45062756581411989;-11.337343621697735685;-2.3274721423993280922;0.43283464592895881662;-10.259368396398576451;-2.000442543264266515;-6.5578605633985622703;4.8245747140118320218;24.973769944359062833;11.400618638893867285;-4.0412044440745331642;-0.11486294203606607633;-1.4288279360437179388;5.394234975456216219;-13.338952120784153266;-10.191478077870348429;-1.182796671467844396;-10.395429713301195918;-3.5726700414247924975;-14.369093316845649611;1.8267671512454017879;9.6525328374333927428;3.5940692159938429917;1.3906313819403968157;1.0278625783811896621;0.23158807453155921818;0.33940911665255424357;0.41218564535485041622;5.3317256312895340287;2.0055237874517963803;-36.376272749656912708;-0.24961252158665728218;-8.9927044066905192921;17.032721045935733883;8.7091096021704590413;-4.4986215733237511216;12.89826868162048612;-5.328950215059013118;14.170292247255311224;28.656549947886578167;0.20756143250468347961;2.6552286300114995576;32.750326692232064829;7.9214961315907705952;-23.66159527847199584;-4.2490499240039332207;-3.4186298707038331735;14.089344206728592113];
IW1_1 = [0.16953345311949552521 -1.8615009241823261554 0.36561574089149628808 -1.5895751751942788221;-1.5186828723606062841 2.4180103221231088462 0.13412871835598005887 0.95919027829716907441;-2.0598790017460539836 -5.9258490377590176124 -2.5258889012916547756 -12.76364078582356143;12.411350943581719974 3.8170970929663927684 -1.1220080411578010615 6.5385558058972401696;1.4396823016169528753 -1.9104927357160215173 -0.11180910343632592674 -0.58221221315617566194;0.41541703601172352833 -0.12145792817678259523 -4.5695904983523893961 -1.506067729213909967;13.498565419873068905 -2.1743500803348818629 3.0448160497388681023 9.8681148552657891315;1.932985253801490888 -1.3012390976606262871 -0.098278557648570685767 -0.039385045429724034605;11.983932664750920338 1.42406087794530678 -0.60295663055562143118 3.5713697564307596011;-12.010687743362426616 3.245146100984428017 2.3068329207759186161 0.71648456946294347691;-32.904411826107661909 3.1001058286942053677 -1.488487262796015953 -13.807271716857295374;-12.445812499178613209 -3.7715306344183696652 1.0320054085463483684 -6.7299485566437375894;5.4964397265150495286 1.7061637045565614113 -2.73911340724962038 0.062484047364775523181;-2.1499387441647264119 0.35439836675570651758 0.047995468370088834043 -0.47514051713253413478;0.5844512360717090127 -0.11542961830577785909 -5.7305219982401860435 -2.2523609756736657772;-23.833453785556663718 -10.064702016222950576 4.9914817823178756484 -16.737681549756448618;13.128766016937241545 -14.046951713946690177 -3.1604919735852332607 -20.660723449545216113;13.306032009554973783 -2.1085203426123917403 3.0062637933094920051 9.8561891264293706172;6.0136572040776501424 -1.2034178727830679989 -0.08496313927809745481 1.458062909431699028;62.137842050973574715 5.2782476134955054192 2.5285593360430165255 -2.0906658350974001159;-34.678472198461371079 2.2533697521189051116 1.234267586496104796 -0.41295761048611795418;-6.8222649829608688066 -19.029964366983683988 20.196354537341289159 -22.187320467795814238;10.123651518001603122 -5.809904607053052672 -0.87756994083849693133 -1.4136110446767466975;1.6979910602476986359 20.947016002156928494 -4.1898784853446002785 10.307850531278131001;14.455384547928012751 21.954486195202573384 -2.8477153583512380131 6.3283549539001731077;1.8000548594669145697 1.8710304305367362332 13.897926935155364703 3.0805118191085694157;7.1772679676997590548 -4.3767091708418490725 -0.90997737314718241119 -3.0387291257316824122;-0.21839572902367676566 2.2534953478687969053 -7.7757770393829632738 -2.7379797832871011209;-0.70637948817687612468 -0.078278831389245878691 0.013049279972072100331 -0.28363871066684026578;3.1014453080483286307 -0.53465539484644375445 -0.06591222614941924518 0.62908707590154078204;18.715060570183496225 10.402709774515862762 -1.5937802702671355348 4.7240747966682459236;0.43350111020163462072 1.443715005972198151 6.5078296880543948788 -3.0604199236893108171;-47.909994218790920684 17.511577769545208838 10.479440698109520724 -0.25068679365044349572;0.12246590228196096994 -3.7062336509878535118 11.124384704949973113 4.9481474977504866786;-8.2349752873184698387 0.35228668728828188561 0.30217783400163844565 -4.3615200023073263935;27.897761051154983392 21.431693084023542895 -2.9331372696496003094 -1.0556894949073769574;17.4655692025371998 -5.0309897330064918819 -2.562112783245174441 0.51773745149510130847;1.0580700257440689427 4.042143177054466463 0.97958512279005194312 3.8004619666412771117;17.679749229926713383 4.4833366696817513741 20.319202493073884597 6.117460109997668205;-9.098439316381531583 2.628979122735717322 1.2063327323120789369 -1.3395864083035269321;15.840045980189534802 -7.4308250383286020835 1.6824447342627615321 2.6938032602852883812;34.300851559092954801 -29.849503924823657997 -11.495625950733757037 14.529840832650117832;0.089576160495465184663 0.24909692401854355293 -2.2363679281296864332 -0.76854495394464472646;3.2957725151056225243 -1.0755315868642167931 -1.3332615055448866492 -0.079775500228462123409;3.2746258923417776998 -16.237361875324868521 18.393177082982813175 -18.634644730897839793;7.0000206194255829573 -11.169237815066781039 7.5520346827603930251 9.0650763881908957842;-29.714006840113643904 8.2842099720473303393 9.4729808766911176576 -9.4015718491322086692;2.8587239185774095951 1.9494734279443886038 -0.91963433900491819983 0.91162616507860794179;-0.0054648855039413132134 -2.1183735759686777023 0.25781454886583660135 -1.9636935391974073006;-1.4334371696159897702 3.3311219448920215136 9.2040984251981150521 6.7931496327460241247];

% Layer 2
b2 = [0.27419615571780031615;0.17837016081183632021;-2.2335648531972820408];
LW2_1 = [0.4956909513844971471 -0.33389209363629862581 0.01875905127991876406 -3.1830385620586665318 -0.34085443226627265556 0.014985657645483927911 1.8132506106111048183 0.27235497282659926199 -0.17298027856762507315 -0.06359714520975406904 0.11698206799914627474 -3.1473446096379715797 0.052547903232231719939 3.3521535354978895249 0.022861230828768844964 0.058149966726123984706 0.0020589483063309550748 -1.8562531542130755735 0.44617368308432142632 -0.20274344096224128364 0.16905077916710342656 0.0053492538970804724002 0.099507157776461505061 0.026136340165269372066 0.0011831426437139513745 0.0076649408564187929485 -0.072245226153779443234 -0.037916436055860307242 -1.1824672014134278708 2.0432042044661615776 -0.035419703688112189055 -0.0028450678474355706703 0.13133721699868752819 -0.044940614632157718789 0.011406861581398175173 -0.023533750693340731164 -0.16147216211341788861 0.042562133378004796125 0.0026209390632394307004 -0.13988951704656935049 0.029734373383095875909 0.0071813211901956266678 -0.032563404319873416604 -0.1136892157361545086 0.0036175228458529724851 -0.0032019170221121114918 -0.016958176276653559589 -0.17246438892882096083 -0.57324356508395302168 0.012580765770258680453;0.42018883577096632909 3.5325413265518479378 -0.028334446608926838751 -3.7025829952114306387 5.7751114175381568216 -0.00934452610259541884 2.0430652502391866143 -2.5196193251574818817 -0.13968839563611976096 0.11099765446786444278 0.14573790078741669096 -3.7464767113007568788 0.069933101274621378707 1.0934392549433966657 -0.036563308100433900005 -0.0713975557417271256 -0.18469936877679912768 -2.1170272411048944861 0.049557619120536189339 -0.02959072897693898474 -0.035532444104514941674 -0.0039895414886650486241 -0.032719167576384114438 -0.029951687571392937581 -0.0032019955085703863396 0.012519670838909181809 -0.045330859167562978507 0.060431031245168430333 -2.8588854633321001408 0.089985480421804805995 0.10782586414030849442 0.015996757424738508591 -0.098554327706604216708 0.051055079752670415316 0.11528298884723219009 0.15802326689002901827 0.083231176090979255844 -0.012204768973532748727 -0.0053381053118747613662 0.039818624639083213812 -0.0035706385820443763482 0.00096151821148040823688 0.083857274096079237324 -0.13055957183259075949 0.008904916117133749448 -0.022254786080330060671 0.017736583369618873912 -0.090609177388862802149 -0.41775050277141589916 0.036323404076657447859;-5.0126869959720705694 -4.9634317843634105927 0.46106584383984133835 1.5996229708235540912 -6.1078668987371580457 1.5115138903603229092 -0.53162552868608503598 1.9063330010811325721 -6.8107570533153060201e-05 -0.10640213045387109103 0.024974068843282497959 1.6917671129706399746 0.19380230402209039364 2.8085787144875915544 0.48982878530178669552 -0.036938218990582513679 0.086024317303154837488 0.57857717773550554341 0.60701094609526107249 -0.14566407149907151242 0.0053009383204522088698 -0.1085317835367781425 0.13078395245045831841 -0.23073559700588786026 0.13976174560235118949 0.092877837521598199944 -0.05315425516607193146 1.4380846981809451979 0.95064037424877467775 1.5837861674989384131 0.0089281222990640288911 -0.46970547162950687659 -0.12006869006181440651 0.90898590289262493069 -1.2466747345145225978 0.17264879937815391653 -0.30457837077968280548 0.69929003174274506627 0.099434577560479381342 0.60383432788828650395 -0.78826233089218666894 -0.41271155020571892447 -2.7086837105358068101 2.658185346189098297 -0.13438338954515707813 0.6211345153714656897 0.35917470656284183894 0.042245274505903825102 3.7156561756713490929 0.45721031417426083454];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.533787165877804;0.788527964418997;2.25106301047751];
y1_step1.xoffset = [-1.82517310309568;0.576613863304083;-0.470200245018933];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
